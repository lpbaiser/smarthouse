<html>

<head>
  <title>Controle</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
</head>

<body>
  <div class="container">
    <h3>Controles do sistema</h3>

    <a id="buzzer" onclick="funcTocaBuzzer.call(this)" class="btn btn-success" style="width:100%">Tocar Buzzer</a>

    <div class="col-md-6">
      <a id="portao" onclick="funcPortao.call(this)" class="btn btn-success" style="width:100%">Abrir portão</a>
      <p id="tabela1"></p>
    </div>
    <div class="col-md-6">
      <a id="porta" onclick="funcPorta.call(this)" class="btn btn-success" style="width:100%">Abrir porta</a>
      <p id="tabela2"></p>
    </div>
  </div>
  </div>

  <script type="text/javascript">
    var controlePortao = 1;
    var controlePorta = 1;
    function funcPortao() {
      var xhttp = new XMLHttpRequest();
      xhttp.open("POST", "/portao", true);
      xhttp.send(JSON.stringify({ controlePortao: controlePortao }));
      $(this).toggleClass('btn-warning');
      if (controlePortao == 1) {
        $(this).text('Fechar portão');
        controlePortao = 0;
      } else {
        controlePortao = 1;
        $(this).text('Abrir portão');
      }
    };

    function funcPorta() {
      var xhttp = new XMLHttpRequest();
      xhttp.open("POST", "/porta", true);
      xhttp.send(JSON.stringify({ controlePorta: controlePorta }));
      $(this).toggleClass('btn-warning');
      if (controlePorta == 1) {
        $(this).text('Fechar porta');
        controlePorta = 0;
      } else {
        controlePorta = 1;
        $(this).text('Abrir porta');
      }
    };

    function funcTocaBuzzer(){
      var xhttp = new XMLHttpRequest();
      xhttp.open("POST", "/buzzer", true);
      xhttp.send();
    }

    function postLogin(){
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("POST", '/index', true); // true for asynchronous 
      xmlHttp.send(JSON.stringify({idlogin: localStorage.getItem(idlogin)}));
    }

    function getLogs() {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", '/getLogs', true); // true for asynchronous 
      xmlHttp.send(null);
      var myObj, tabela1 = '', tabela2 = '', myJson;
      xmlHttp.onreadystatechange = function () {
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
          myJson = JSON.parse(xmlHttp.responseText);
          myObj = myJson.logs;
          if (myObj.length > 0) {
            tabela1 += "<table class='table' border='1'>"
            tabela2 += "<table class='table' border='1'>"
            tabela1 += "<th> LOGIN</th>"
            tabela2 += "<th> LOGIN</th>"
            tabela1 += "<th> AÇÃO</th>"
            tabela2 += "<th> AÇÃO</th>"
            tabela1 += "<th> TIPO</th>"
            tabela2 += "<th> TIPO</th>"
            tabela1 += "<th> DATA</th>"
            tabela2 += "<th> DATA</th>"
            myObj.map(function (item, index) {
              if (item.tipo === 'PORTAO') {
                tabela1 += "<tr><td>" + item.idlogin + "</td>";
                tabela1 += "<td>" + item.acao + "</td>";
                tabela1 += "<td>" + item.tipo + "</td>";
                tabela1 += "<td>" + moment(item.data).zone(-3).format('DD/MM/YYYY - hh:mm:ss') + "</td></tr>";
              } else {
                tabela2 += "<tr><td>" + item.idlogin + "</td>";
                tabela2 += "<td>" + item.acao + "</td>";
                tabela2 += "<td>" + item.tipo + "</td>";
                tabela2 += "<td>" + moment(item.data).zone(-3).format('DD/MM/YYYY - hh:mm:ss') + "</td></tr>";
              }
            })
            tabela1 += "</table>"
            document.getElementById("tabela1").innerHTML = tabela1;
            document.getElementById("tabela2").innerHTML = tabela2;
          }
        }
      }
    };
    window.onload = getLogs;
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://momentjs.com/downloads/moment.js"></script>
</body>

</html>